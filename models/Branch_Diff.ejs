<hr/>
<link rel="stylesheet" type="text/css" href="/css/diff2html.min.css">
<h3>Branch Changes</h3>
<div class='clear diff_<%=model.class%>' style='margin-top:10px;margin-bottom:20px;'></div>
<div class='spacer_<%=model.class%>'></div>

<script type="text/x-jsharmony-template" class="<%=model.class%>_Changes_Listing">
  <div class="clear"></div>

  <!-- ---------- -->
  <!-- NO CHANGES -->
  <!-- ---------- -->
  <# if(!branch_diff.branch_pages.length && !branch_diff.branch_media.length && !branch_diff.branch_menus.length && !branch_diff.branch_redirects.length){ #>
    <hr/>
    <h4 class="<%=model.class%>_branch_diff_item_header">No changes in this branch</h4>
  <# } #>


  <!-- ----- -->
  <!-- PAGES -->
  <!-- ----- -->
  <# _.each(branch_diff.branch_pages, function(branch_page){ #>
    <hr/>

    <h4 class="<%=model.class%>_branch_diff_item_header">
      <# if(branch_page.branch_page_action=='ADD'){ #>ADDED PAGE &nbsp;&nbsp;<#-XExt.escapeHTML(branch_page.new_page_path)#><# } #>
      <# if(branch_page.branch_page_action=='DELETE'){ #>DELETED PAGE <#-XExt.escapeHTML(branch_page.old_page_path)#><# } #>
      <# if(branch_page.branch_page_action=='UPDATE'){ #>UPDATED PAGE <#-XExt.escapeHTML(branch_page.old_page_path)#><# } #>
      <# if((branch_page.branch_page_action=='UPDATE') && (branch_page.new_page_path!=branch_page.old_page_path)){ #><br/>RENAMED TO &nbsp;&nbsp;<#-XExt.escapeHTML(branch_page.new_page_path)#><# } #>
    </h4>

    <# _.each(_.pick(branch_page.diff,['page_title','template_title']), function(val, key){ #>
      <div class="<%=model.class%>_diff_item"><b>New <#=map(key,'page')#></b>: <#=val#></div>
    <# }); #>

    <# _.each(branch_page.diff && branch_page.diff.seo, function(val, key){ #>
      <div class="<%=model.class%>_diff_item"><b>New SEO <#=map(key,'page_seo')#></b>: <#=val#></div>
    <# }); #>

    <# _.each(_.omit(branch_page.diff,['seo','content','content_elements','page_title','template_title']), function(val, key){ #>
      <div class="<%=model.class%>_diff_head"><#=map(key,'page')#></div>
      <div class="<%=model.class%>_diff"><#=val#></div>
    <# }); #>

    <# _.each(branch_page.diff && branch_page.diff.content, function(val, key){ #>
      <div class="<%=model.class%>_diff_head">Content - <#=branch_page.diff.content_elements[key]#></div>
      <div class="<%=model.class%>_diff"><#-val#></div>
    <# }); #>

  <# }); #>


  <!-- ----- -->
  <!-- MEDIA -->
  <!-- ----- -->
  <# _.each(branch_diff.branch_media, function(branch_media){ #>
    <hr/>

    <h4 class="<%=model.class%>_branch_diff_item_header">
      <# if(branch_media.branch_media_action=='ADD'){ #>ADDED MEDIA &nbsp;&nbsp;<#-XExt.escapeHTML(branch_media.new_media_path)#><# } #>
      <# if(branch_media.branch_media_action=='DELETE'){ #>DELETED MEDIA <#-XExt.escapeHTML(branch_media.old_media_path)#><# } #>
      <# if(branch_media.branch_media_action=='UPDATE'){ #>UPDATED MEDIA <#-XExt.escapeHTML(branch_media.old_media_path)#><# } #>
      <# if((branch_media.branch_media_action=='UPDATE') && (branch_media.new_media_path!=branch_media.old_media_path)){ #><br/>RENAMED TO &nbsp;&nbsp;<#-XExt.escapeHTML(branch_media.new_media_path)#><# } #>
    </h4>

  <# }); #>


  <!-- ----- -->
  <!-- MENUS -->
  <!-- ----- -->
  <# _.each(branch_diff.branch_menus, function(branch_menu){ #>
    <hr/>

    <h4 class="<%=model.class%>_branch_diff_item_header">
      <# if(branch_menu.branch_menu_action=='ADD'){ #>ADDED MENU &nbsp;&nbsp;<#-XExt.escapeHTML(branch_menu.new_menu_tag)#><# } #>
      <# if(branch_menu.branch_menu_action=='DELETE'){ #>DELETED MENU <#-XExt.escapeHTML(branch_menu.old_menu_tag)#><# } #>
      <# if(branch_menu.branch_menu_action=='UPDATE'){ #>UPDATED MENU <#-XExt.escapeHTML(branch_menu.old_menu_tag)#><# } #>
      <# if((branch_menu.branch_menu_action=='UPDATE') && (branch_menu.new_menu_tag!=branch_menu.old_menu_tag)){ #><br/>RENAMED TO &nbsp;&nbsp;<#-XExt.escapeHTML(branch_menu.new_menu_tag)#><# } #>
    </h4>

    <# _.each(_.pick(branch_menu.diff,['menu_name','template_title','menu_path']), function(val, key){ #>
      <div class="<%=model.class%>_diff_item"><b>New <#=map(key,'menu')#></b>: <#=val#></div>
    <# }); #>

    <# _.each(_.pick(branch_menu.diff,['menu_items']), function(val, key){ #>
      <div class="<%=model.class%>_diff_head">Content - <#=map(key,'menu')#></div>
      <div class="<%=model.class%>_diff"><#-val#></div>
    <# }); #>

  <# }); #>


  <!-- --------- -->
  <!-- REDIRECTS -->
  <!-- --------- -->
  <# _.each(branch_diff.branch_redirects, function(branch_redirect){ #>
    <hr/>

    <h4 class="<%=model.class%>_branch_diff_item_header">
      <# if(branch_redirect.branch_redirect_action=='ADD'){ #>ADDED REDIRECT &nbsp;&nbsp;<#-XExt.escapeHTML(branch_redirect.new_redirect_url)#><# } #>
      <# if(branch_redirect.branch_redirect_action=='DELETE'){ #>DELETED REDIRECT <#-XExt.escapeHTML(branch_redirect.old_redirect_url)#><# } #>
      <# if(branch_redirect.branch_redirect_action=='UPDATE'){ #>UPDATED REDIRECT <#-XExt.escapeHTML(branch_redirect.old_redirect_url)#><# } #>
      <# if(branch_redirect.branch_redirect_action=='UPDATE'){ #>
         <# if(branch_redirect.new_redirect_url!=branch_redirect.old_redirect_url){ #><br/>New URL: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<#-XExt.escapeHTML(branch_redirect.new_redirect_url)#><# } #>
         <# if(branch_redirect.new_redirect_dest!=branch_redirect.old_redirect_dest){ #><br/>New Destination: <#-XExt.escapeHTML(branch_redirect.new_redirect_dest)#><# } #>
      <# } #>
    </h4>

  <# }); #>

  <hr/>
</script>