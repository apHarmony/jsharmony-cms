{
  "{schema}.my_user_is_publisher":{
    "params": ["SITE_ID"],
    "sql": [
      "(case when exists(select * from {schema}.v_sys_user_site_access where v_sys_user_site_access.site_id=(%%%SITE_ID%%%) and v_sys_user_site_access.sys_user_id=jsharmony.my_sys_user_id() and (v_sys_user_site_access.sys_user_site_access='PUBLISHER' or v_sys_user_site_access.sys_user_site_access='WEBMASTER')) then 1 else 0 end)"
    ]
  },
  "{schema}.my_current_branch_id":{
    "params": [],
    "sql": [
      "(select sys_user_site.branch_id from {schema}.sys_user_session inner join {schema}.sys_user_site on sys_user_site.sys_user_id = sys_user_session.sys_user_id and sys_user_session.site_id = sys_user_site.site_id where {schema}.sys_user_session.sys_user_id=jsharmony.my_sys_user_id())"
    ]
  },
  "{schema}.my_current_site_id":{
    "params": [],
    "sql": [
      "(select sys_user_session.site_id from {schema}.sys_user_session where sys_user_session.sys_user_id=jsharmony.my_sys_user_id())"
    ]
  },
  "{schema}.my_current_branch_is_editable":{
    "params": [],
    "sql": [
      "ifnull((select case branch_access when 'RW' then 1 else 0 end is_editable from {schema}.v_my_branch_access where branch_id={schema}.my_current_branch_id()),0)"
    ]
  },
  "{schema}.my_current_branch_is_versioned":{
    "params": [],
    "sql": [
      "ifnull((select case branch_type when 'USER' then 1 else 0 end is_versioned from {schema}.v_my_branch_access where branch_id={schema}.my_current_branch_id()),0)"
    ]
  },
  "{schema}.my_current_branch_is_merging":{
    "params": [],
    "sql": [
      "ifnull((select case when branch_merge_id is not null then 1 else 0 end is_merging from {schema}.branch where branch_id={schema}.my_current_branch_id()),0)"
    ]
  },
  "{schema}.dirname":{
    "params": ["PATH"],
    "sql": [
      "ifnull(rtrim((%%%PATH%%%), replace((%%%PATH%%%), '/', '')),'/')"
    ]
  },
  "{schema}.filename":{
    "params": ["PATH"],
    "sql": [
      "ifnull(replace((%%%PATH%%%), rtrim((%%%PATH%%%), replace((%%%PATH%%%), '/', '')), ''),'')"
    ]
  },
  "{schema}.insert_media":{
    "params": ["media_desc", "media_path", "media_tags", "media_type", "media_ext", "media_size", "media_width", "media_height"],
    "sql": [
      "insert into {schema}.v_my_media(media_desc, media_path, media_tags, media_type, media_ext, media_size, media_width, media_height) values(%%%media_desc%%%, %%%media_path%%%, %%%media_tags%%%, %%%media_type%%%, %%%media_ext%%%, %%%media_size%%%, %%%media_width%%%, %%%media_height%%%);select last_insert_rowid_override media_key from jsharmony_meta;"
    ]
  },
  "{schema}.duplicate_page":{
    "params": ["page_key", "page_path", "page_title"],
    "sql": [
      "insert into {schema}.v_my_page(page_path, page_file_id, page_title, page_template_id, page_seo_title, page_seo_canonical_url, page_seo_metadesc, page_lang) select %%%page_path%%%, page_file_id, %%%page_title%%%, page_template_id, page_seo_title, page_seo_canonical_url, page_seo_metadesc, page_lang from {schema}.v_my_page where page_key=%%%page_key%%%;select last_insert_rowid_override page_key from jsharmony_meta;"
    ]
  },
  "jsHarmonyCMS_Upload": "insert into {schema}.v_my_{item}({columns}) values ({values}); select last_insert_rowid_override {item}_key from jsharmony_meta;",
  "jsHarmonyCMS_GetNextDeployment": "select deployment_id from {schema}.deployment where deployment_sts='PENDING' and strftime('%Y-%m-%dT%H:%M:%f',deployment_date) <= strftime('%Y-%m-%dT%H:%M:%f',%%%%%%jsh.map.timestamp%%%%%%) order by deployment_date asc;",
  "jsHarmonyCMS_Dashboard_BranchOverview": [
    "select 'branch' code_val, branch_name code_txt, 1 cnt from {schema}.branch where branch_id={schema}.my_current_branch_id() union all ",
    "foreach(%%%cms.branch_items%%%, union all , \"",
    "select '{item}' code_val, '{item_caption_2}' code_txt, count(*) cnt from {tbl_branch_item} where branch_id={schema}.my_current_branch_id() and {item}_id is not null",
    "\")"
  ],
  "jsHarmonyCMS_Dashboard_NewContentPieChart": [
    "foreach(%%%cms.branch_items%%%, union all , \"",
    "select '{item_caption_2}' code_txt, count(*) cnt from {tbl_item} where site_id={schema}.my_current_site_id() and {item}_orig_id is null and {item}_etstmp > datetime(jsharmony.my_now(),'-30 days')",
    "\")"
  ],
  "jsHarmonyCMS_Dashboard_UserPieChart": [
    "select (jsharmony.my_db_user_fmt(euser)) code_txt,cnt from",
    "  (select euser, sum(cnt) cnt from ",
    "    (foreach(%%%cms.branch_items%%%, union all , \"",
    "      select {item}_euser euser, count(*) cnt from {tbl_item} where site_id={schema}.my_current_site_id() and {item}_etstmp > datetime(jsharmony.my_now(),'-30 days') group by {item}_euser",
    "    \")) items",
    "   group by euser) user_activity where euser <> 'USystem'"
  ],
}